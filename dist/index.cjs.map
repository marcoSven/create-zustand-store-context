{"version":3,"file":"index.cjs","sources":["../src/index.tsx"],"sourcesContent":["import { createContext, useCallback, useContext, useRef } from \"react\";\n\nimport { createStore as create, StoreApi, useStore } from \"zustand\";\nimport { persist } from \"zustand/middleware\";\nimport { shallow } from \"zustand/shallow\";\n\nconst DEFAULT_ZUSTAND_STORE_Value = \"DEFAULT_ZUSTAND_STORE_Value\";\n\nexport function createZustandStoreContext<\n  T extends Record<string, unknown>,\n  O extends string = \"\"\n>({\n  defaultState,\n  localStorage,\n  name,\n}: {\n  defaultState: T;\n  localStorage?: {\n    force?: boolean;\n    migrate?: (persistedState: unknown, version: number) => T;\n    name: string;\n    partialize?: (state: T) => Partial<T>;\n    version?: number;\n  };\n  name?: string;\n}) {\n  const createStore = !localStorage\n    ? (state: T) => create<T>(() => state)\n    : (state: T) => {\n        const { migrate, partialize, ...config } = localStorage;\n        const isObject = (obj: unknown): obj is Record<string, unknown> =>\n          typeof obj === \"object\" &&\n          obj !== null &&\n          !Array.isArray(obj) &&\n          Object.keys(obj).every((key) => typeof key === \"string\");\n\n        const store = create<T>()(\n          persist(() => state, {\n            ...config,\n            migrate: migrate\n              ? (persistedState: unknown, version: number): T =>\n                  isObject(persistedState)\n                    ? ((obj: Record<string, unknown>) =>\n                        ((obj): obj is T => {\n                          const set: Record<string, unknown> = {};\n\n                          for (const k of Object.keys(obj)) {\n                            set[k] = 1;\n                          }\n\n                          for (const k of Object.keys(\n                            (localStorage &&\n                              localStorage.partialize?.(state)) ||\n                              state\n                          )) {\n                            if (!set[k]) return false;\n\n                            set[k] = 2;\n                          }\n\n                          for (const k in set) {\n                            if (set[k] === 1) return false;\n                          }\n\n                          return true;\n                        })(obj)\n                          ? obj\n                          : state)(migrate(persistedState, version))\n                    : state\n              : undefined,\n            partialize: partialize || ((state) => state),\n          })\n        );\n\n        localStorage.force && store.setState(state);\n\n        return store;\n      };\n  const defaultStore = createStore({\n    ...defaultState,\n    [DEFAULT_ZUSTAND_STORE_Value]: true,\n  });\n  const storeContext = createContext(defaultStore);\n\n  const useContextStore = (storeId?: string, initialState: Partial<T> = {}) => {\n    const prevId = useRef(storeId);\n    const storeRef = useRef<StoreApi<T>>();\n\n    if (!storeRef.current || prevId.current !== storeId) {\n      storeRef.current = createStore({\n        ...defaultState,\n        ...initialState,\n      });\n\n      prevId.current = storeId;\n    }\n\n    return storeRef.current;\n  };\n\n  type StateAPI = Omit<StoreApi<T>, \"setState\" | \"getState\" | \"destroy\"> & {\n    setState: (value: Partial<Omit<T, O>>) => void;\n  };\n\n  function useState(): StateAPI;\n\n  function useState<U extends Record<string, unknown>>(\n    selector: (state: T) => U\n  ): StateAPI & U;\n\n  function useState<U extends Record<string, unknown>>(\n    selector?: (state: T) => U\n  ): StateAPI & U {\n    const store = useContext(storeContext);\n\n    if (\n      typeof store === \"undefined\" ||\n      store.getState()[DEFAULT_ZUSTAND_STORE_Value]\n    ) {\n      throw new Error(\n        `${name ? name + \": \" : \"\"}useState must be used within a provider`\n      );\n    }\n\n    const state = useStore(store, selector ?? (() => ({} as U)), shallow);\n\n    return {\n      ...store,\n      ...state,\n      setState: useCallback(\n        (value: Partial<Omit<T, O>>) =>\n          store.setState((state: T) => ({ ...state, ...value })),\n        [store]\n      ),\n    };\n  }\n\n  return {\n    storeContext,\n    useState,\n    useStore: useContextStore,\n  };\n}\n"],"names":["_excluded","DEFAULT_ZUSTAND_STORE_Value","_ref","_extends2","defaultState","localStorage","name","createStore","state","migrate","partialize","config","_objectWithoutPropertiesLoose","store","create","persist","_extends","persistedState","version","obj","Array","isArray","Object","keys","every","key","set","_i","_Object$keys","length","_i2","_Object$keys2","k","undefined","force","setState","defaultStore","storeContext","createContext","useState","selector","useContext","getState","Error","useStore","shallow","useCallback","value","storeId","initialState","prevId","useRef","storeRef","current"],"mappings":"6UAAA,IAAAA,EAAA,CAAA,UAAA,cAMMC,EAA8B,gEAEpB,SAAyBC,GAiBxC,IAAAC,EAbCC,EAAYF,EAAZE,aACAC,EAAYH,EAAZG,aACAC,EAAIJ,EAAJI,KAYMC,EAAeF,EAEjB,SAACG,GACC,IAAQC,EAAmCJ,EAAnCI,QAASC,EAA0BL,EAA1BK,WAAeC,oIAAMC,CAAKP,EAAYL,GAOjDa,EAAQC,EAAAA,aAAAA,CACZC,UAAQ,WAAM,OAAAP,CAAK,EAAAQ,EAAA,CAAA,EACdL,EACHF,CAAAA,QAASA,EACL,SAACQ,EAAyBC,SATjB,iBADCC,EAWCF,IATT,OAARE,IACCC,MAAMC,QAAQF,IACfG,OAAOC,KAAKJ,GAAKK,MAAM,SAACC,GAAQ,MAAe,iBAARA,CAAgB,GAQ1C,SAACN,UACEA,SAAAA,GAGA,IAFA,IAAMO,EAA+B,GAErCC,EAAA,EAAAC,EAAgBN,OAAOC,KAAKJ,GAAIQ,EAAAC,EAAAC,OAAAF,IAC9BD,EADUE,EAAAD,IACD,EAGX,IAAAG,IAAAA,EAAAC,EAAAA,EAAgBT,OAAOC,KACpBlB,IACCA,MAAAA,EAAaK,gBAAbL,EAAAA,EAAaK,WAAaF,KAC1BA,GACHsB,EAAAC,EAAAF,OAAAC,IAAE,CAJE,IAAME,EAACD,EAAAD,GAKV,IAAKJ,EAAIM,GAAI,OAAO,EAEpBN,EAAIM,GAAK,CACV,CAED,IAAK,IAAMA,KAAKN,EACd,GAAe,IAAXA,EAAIM,GAAU,OACnB,EAED,OAAO,CACT,CAtBEb,CAsBCA,GACCA,EACAX,CAAK,CAzBV,CAyBYC,EAAQQ,EAAgBC,IACrCV,EAtCG,IAACW,CAsCC,OACXc,EACJvB,WAAYA,GAAe,SAACF,GAAU,OAAAA,CAAK,MAM/C,OAFAH,EAAa6B,OAASrB,EAAMsB,SAAS3B,GAE9BK,CACT,EAlDA,SAACL,GAAQ,OAAKM,cAAU,WAAA,OAAMN,CAAK,EAAC,EAmDlC4B,EAAe7B,EAAWS,EAAA,CAAA,EAC3BZ,IAAYD,EAAAA,CAAAA,GACdF,IAA8B,EAAIE,KAE/BkC,EAAeC,EAAAA,cAAcF,GAuDnC,MAAO,CACLC,aAAAA,EACAE,SA7BF,SACEC,GAEA,IAAM3B,EAAQ4B,EAAAA,WAAWJ,GAEzB,QACmB,IAAVxB,GACPA,EAAM6B,WAAWzC,GAEjB,MAAU,IAAA0C,OACLrC,EAAOA,EAAO,KAAO,IAAE,2CAI9B,IAAME,EAAQoC,EAAAA,SAAS/B,EAAO2B,MAAAA,EAAAA,EAAa,WAAO,MAAA,CAAQ,CAAA,EAAGK,EAAOA,SAEpE,OAAA7B,EAAA,CAAA,EACKH,EACAL,EACH2B,CAAAA,SAAUW,EAAAA,YACR,SAACC,GACC,OAAAlC,EAAMsB,SAAS,SAAC3B,GAAQ,OAAAQ,EAAA,CAAA,EAAWR,EAAUuC,EAAQ,EAAC,EACxD,CAAClC,KAGP,EAKE+B,SAxDsB,SAACI,EAAkBC,YAAAA,IAAAA,EAA2B,CAAE,GACtE,IAAMC,EAASC,EAAMA,OAACH,GAChBI,EAAWD,EAAAA,SAWjB,OATKC,EAASC,SAAWH,EAAOG,UAAYL,IAC1CI,EAASC,QAAU9C,EAAWS,EACzBZ,CAAAA,EAAAA,EACA6C,IAGLC,EAAOG,QAAUL,GAGZI,EAASC,OAClB,EA4CF"}