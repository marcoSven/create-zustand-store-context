{"version":3,"file":"index.module.js","sources":["../src/index.tsx"],"sourcesContent":["import { createContext, useCallback, useContext, useRef } from \"react\";\n\nimport { createStore as create, StoreApi, useStore } from \"zustand\";\nimport { persist } from \"zustand/middleware\";\nimport { shallow } from \"zustand/shallow\";\n\nconst DEFAULT_ZUSTAND_STORE_Value = \"DEFAULT_ZUSTAND_STORE_Value\";\n\nexport default function createZustandStoreContext<\n  T extends Record<string, unknown>,\n  O extends string = \"\"\n>({\n  defaultState,\n  localStorage,\n  name,\n}: {\n  defaultState: T;\n  localStorage?: {\n    force?: boolean;\n    migrate?: (persistedState: unknown, version: number) => T;\n    name: string;\n    partialize?: (state: T) => Partial<T>;\n    version?: number;\n  };\n  name?: string;\n}) {\n  const createStore = !localStorage\n    ? (state: T) => create<T>(() => state)\n    : (state: T) => {\n        const store = create<T>()(\n          persist(() => state, {\n            ...localStorage,\n            partialize:\n              localStorage.partialize ||\n              ((state) => {\n                delete state[\"DEFAULT_ZUSTAND_STORE_Value\"];\n                return state;\n              }),\n          })\n        );\n\n        localStorage.force && store.setState(state);\n\n        return store;\n      };\n  const defaultStore = createStore({\n    ...defaultState,\n    [DEFAULT_ZUSTAND_STORE_Value]: true,\n  });\n  const storeContext = createContext(defaultStore);\n\n  const useContextStore = (storeId?: string, initialState: Partial<T> = {}) => {\n    const prevId = useRef(storeId);\n    const storeRef = useRef<StoreApi<T>>();\n\n    if (!storeRef.current || prevId.current !== storeId) {\n      storeRef.current = createStore({\n        ...defaultState,\n        ...initialState,\n      });\n\n      prevId.current = storeId;\n    }\n\n    return storeRef.current;\n  };\n\n  type StateAPI = Omit<StoreApi<T>, \"setState\" | \"getState\" | \"destroy\"> & {\n    setState: (value: Partial<Omit<T, O>>) => void;\n  };\n\n  function useState(): StateAPI;\n\n  function useState<U extends Record<string, unknown>>(\n    selector: (state: T) => U\n  ): StateAPI & U;\n\n  function useState<U extends Record<string, unknown>>(\n    selector?: (state: T) => U\n  ): StateAPI & U {\n    const store = useContext(storeContext);\n\n    if (\n      typeof store === \"undefined\" ||\n      store.getState()[DEFAULT_ZUSTAND_STORE_Value]\n    ) {\n      throw new Error(\n        `${name ? name + \": \" : \"\"}useState must be used within a provider`\n      );\n    }\n\n    const state = useStore(store, selector ?? (() => ({} as U)), shallow);\n\n    return {\n      ...store,\n      ...state,\n      setState: useCallback(\n        (value: Partial<Omit<T, O>>) =>\n          store.setState((state: T) => ({ ...state, ...value })),\n        [store]\n      ),\n    };\n  }\n\n  return {\n    storeContext,\n    useState,\n    useStore: useContextStore,\n  };\n}\n"],"names":["DEFAULT_ZUSTAND_STORE_Value","createZustandStoreContext","_ref","_extends2","defaultState","localStorage","name","createStore","state","store","create","persist","_extends","partialize","force","setState","defaultStore","createContext","storeContext","useState","selector","useContext","getState","Error","useStore","shallow","useCallback","value","storeId","initialState","prevId","useRef","storeRef","current"],"mappings":"kcAMA,IAAiCA,EAAG,8BAEZC,SAAAA,EAiBvBC,GAAA,IAAAC,IAbCC,EAAAA,aACAC,IAAAA,aACAC,EAAIJ,EAAJI,KAYiBC,EAAIF,EAEjB,SAACG,GACC,IAAMC,EAAQC,IACZC,EAAQ,WAAA,OAAWH,CAAA,EAAAI,EAAA,CAAA,EACdP,EAAY,CACfQ,WACER,EAAaQ,YACZ,SAACL,GAEA,cADYA,EAA8B,4BACnCA,CACT,MAMN,OAFAH,EAAaS,OAASL,EAAMM,SAASP,GAE9BC,CACT,EAjBA,SAACD,UAAmBE,EAAI,WAAMF,OAAAA,CAAK,EAAC,EAkBtBQ,EAAGT,EAChBH,EAAAA,CAAAA,EAAAA,IACFJ,EAAAA,CAAAA,GAAAA,IAA8B,EAAIG,OAEhBc,EAAcD,GAuDnC,MAAO,CACLE,aAAAA,EACAC,SA7BF,SACEC,GAEA,IAAWX,EAAGY,EAAWH,GAEzB,QACmB,IAAVT,GACPA,EAAMa,WAAWtB,GAEjB,MAAUuB,IAAAA,OACLjB,EAAOA,EAAO,KAAO,IAE3B,2CAED,IAAME,EAAQgB,EAASf,EAAOW,MAAAA,EAAAA,EAAa,WAAA,MAAO,CAAQ,CAAA,EAAGK,GAE7D,OAAAb,EAAA,CAAA,EACKH,EACAD,EACHO,CAAAA,SAAUW,EACR,SAACC,GACClB,OAAAA,EAAMM,SAAS,SAACP,eAAmBA,EAAUmB,EAAK,EAAI,EACxD,CAAClB,KAGP,EAKEe,SAxDsB,SAACI,EAAkBC,QAA2B,IAA3BA,IAAAA,EAA2B,IACpE,IAAMC,EAASC,EAAOH,KACLG,IAWjB,OATKC,EAASC,SAAWH,EAAOG,UAAYL,IAC1CI,EAASC,QAAU1B,EACdH,EAAAA,CAAAA,EAAAA,EACAyB,IAGLC,EAAOG,QAAUL,GAGJI,EAACC,OAClB,EA4CF"}