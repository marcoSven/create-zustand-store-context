{"version":3,"file":"index.module.js","sources":["../src/index.tsx"],"sourcesContent":["import { createContext, useCallback, useContext, useRef } from \"react\";\n\nimport { createStore as create, StoreApi, useStore } from \"zustand\";\nimport { persist } from \"zustand/middleware\";\nimport { shallow } from \"zustand/shallow\";\n\nconst DEFAULT_ZUSTAND_STORE_Value = \"DEFAULT_ZUSTAND_STORE_Value\";\n\nexport function createZustandStoreContext<\n  T extends Record<string, unknown>,\n  O extends string = \"\"\n>({\n  defaultState,\n  localStorage,\n  name,\n}: {\n  defaultState: T;\n  localStorage?: {\n    force?: boolean;\n    migrate?: (persistedState: unknown, version: number) => T;\n    name: string;\n    partialize?: (state: T) => Partial<T>;\n    version?: number;\n  };\n  name?: string;\n}) {\n  const createStore = !localStorage\n    ? (state: T) => create<T>(() => state)\n    : (state: T) => {\n        const { migrate, partialize, ...config } = localStorage;\n        const isObject = (obj: unknown): obj is Record<string, unknown> =>\n          typeof obj === \"object\" &&\n          obj !== null &&\n          !Array.isArray(obj) &&\n          Object.keys(obj).every((key) => typeof key === \"string\");\n\n        const store = create<T>()(\n          persist(() => state, {\n            ...config,\n            migrate: migrate\n              ? (persistedState: unknown, version: number): T =>\n                  isObject(persistedState)\n                    ? ((obj: Record<string, unknown>) =>\n                        ((obj): obj is T => {\n                          const set: Record<string, unknown> = {};\n\n                          for (const k of Object.keys(obj)) {\n                            set[k] = 1;\n                          }\n\n                          for (const k of Object.keys(\n                            (localStorage &&\n                              localStorage.partialize?.(state)) ||\n                              state\n                          )) {\n                            if (!set[k]) return false;\n\n                            set[k] = 2;\n                          }\n\n                          for (const k in set) {\n                            if (set[k] === 1) return false;\n                          }\n\n                          return true;\n                        })(obj)\n                          ? obj\n                          : state)(migrate(persistedState, version))\n                    : state\n              : undefined,\n            partialize: partialize || ((state) => state),\n          })\n        );\n\n        localStorage.force && store.setState(state);\n\n        return store;\n      };\n  const defaultStore = createStore({\n    ...defaultState,\n    [DEFAULT_ZUSTAND_STORE_Value]: true,\n  });\n  const storeContext = createContext(defaultStore);\n\n  const useContextStore = (storeId?: string, initialState: Partial<T> = {}) => {\n    const prevId = useRef(storeId);\n    const storeRef = useRef<StoreApi<T>>();\n\n    if (!storeRef.current || prevId.current !== storeId) {\n      storeRef.current = createStore({\n        ...defaultState,\n        ...initialState,\n      });\n\n      prevId.current = storeId;\n    }\n\n    return storeRef.current;\n  };\n\n  type StateAPI = Omit<StoreApi<T>, \"setState\" | \"getState\" | \"destroy\"> & {\n    setState: (value: Partial<Omit<T, O>>) => void;\n  };\n\n  function useState(): StateAPI;\n\n  function useState<U extends Record<string, unknown>>(\n    selector: (state: T) => U\n  ): StateAPI & U;\n\n  function useState<U extends Record<string, unknown>>(\n    selector?: (state: T) => U\n  ): StateAPI & U {\n    const store = useContext(storeContext);\n\n    if (\n      typeof store === \"undefined\" ||\n      store.getState()[DEFAULT_ZUSTAND_STORE_Value]\n    ) {\n      throw new Error(\n        `${name ? name + \": \" : \"\"}useState must be used within a provider`\n      );\n    }\n\n    const state = useStore(store, selector ?? (() => ({} as U)), shallow);\n\n    return {\n      ...store,\n      ...state,\n      setState: useCallback(\n        (value: Partial<Omit<T, O>>) =>\n          store.setState((state: T) => ({ ...state, ...value })),\n        [store]\n      ),\n    };\n  }\n\n  return {\n    storeContext,\n    useState,\n    useStore: useContextStore,\n  };\n}\n"],"names":["DEFAULT_ZUSTAND_STORE_Value","createZustandStoreContext","_ref","defaultState","localStorage","name","createStore","state","migrate","partialize","config","_objectWithoutPropertiesLoose","_excluded","store","create","persist","_extends","persistedState","version","isObject","obj","Array","isArray","Object","keys","every","key","set","_i","_Object$keys","length","_i2","_Object$keys2","k","undefined","force","setState","defaultStore","_extends2","storeContext","createContext","useState","selector","useContext","getState","Error","useStore","shallow","useCallback","value","storeId","initialState","prevId","useRef","storeRef","current"],"mappings":"ieAMiCA,EAAG,8BAE9B,SAAmCC,EAAAC,GAIvCC,IAAAA,EAAAA,EAAAA,EAAAA,aACAC,EAAAA,EAAAA,aACAC,EAAAA,EAAAA,KAYiBC,EAAIF,EAEjB,SAACG,GACC,IAAeC,EAA4BJ,EAAnCI,QAASC,EAA0BL,EAA1BK,WAAeC,oIAAMC,CAAKP,EAAYQ,GAO5CC,EAAGC,IACZC,EAAQ,WAAA,OAAWR,CAAA,EAAAS,EAAA,CAAA,EACdN,EAAM,CACTF,QAASA,EACL,SAACS,EAAyBC,GACxBC,MAVO,iBADCC,EAWCH,IATT,OAARG,IACCC,MAAMC,QAAQF,IACfG,OAAOC,KAAKJ,GAAKK,MAAM,SAACC,GAAQ,MAAe,iBAALA,CAAa,GAQ1C,SAACN,GAA4B,OAC1BA,SAAAA,GAGA,IAFA,IAAMO,EAA+B,GAErBJ,EAAAA,EAAAA,EAAAA,OAAOC,KAAKJ,GAAIQ,EAAAC,EAAAC,OAAAF,IAC9BD,EADUE,EAAAD,IACD,EAGX,IAAgBL,IAAAA,EAAAA,EAAAA,EAAAA,OAAOC,KACpBpB,IACCA,MAAAA,EAAaK,gBAAbL,EAAAA,EAAaK,WAAaF,KAC1BA,GACDwB,EAAAC,EAAAF,OAAAC,IAAA,CAJE,IAAME,EAKTD,EAAAD,GAAA,IAAKJ,EAAIM,GAAI,OAAY,EAEzBN,EAAIM,GAAK,CACV,CAED,IAAK,IAAMA,KAAKN,EACd,GAAe,IAAXA,EAAIM,GAAU,OACnB,EAED,OAAO,CACT,CAtBEb,CAsBCA,GACCA,EACAb,CAAK,CAzBV,CAyBYC,EAAQS,EAAgBC,IACrCX,EAtCG,IAACa,CAsCC,OACXc,EACJzB,WAAYA,GAAe,SAACF,GAAUA,OAAAA,CAAK,MAM/C,OAFAH,EAAa+B,OAAStB,EAAMuB,SAAS7B,GAGvCM,CAAA,EAlDA,SAACN,GAAQ,SAAe,WAAA,OAAWA,CAAA,EAAC,EAmDtB8B,EAAG/B,EAAWU,EAAA,CAAA,EAC3Bb,IAAYmC,EAAA,CAAA,GACdtC,IAA8B,EAC/BsC,KACIC,EAAeC,EAAcH,GAuDnC,MAAO,CACLE,aAAAA,EACAE,SA7BF,SACEC,GAEA,IAAM7B,EAAQ8B,EAAWJ,GAEzB,QACmB,IAAV1B,GACPA,EAAM+B,WAAW5C,GAEjB,MAAM,IAAS6C,OACVxC,EAAOA,EAAO,KAAO,IAAE,2CAI9B,IAAWE,EAAGuC,EAASjC,EAAO6B,MAAAA,EAAAA,EAAa,WAAA,MAAO,CAAQ,CAAA,EAAGK,GAE7D,OAAA/B,EAAA,CAAA,EACKH,EACAN,EAAK,CACR6B,SAAUY,EACR,SAACC,GACCpC,OAAAA,EAAMuB,SAAS,SAAC7B,GAAmBA,OAAAA,EAAAA,CAAAA,EAAAA,EAAU0C,EAAQ,EAAC,EACxD,CAACpC,KAGP,EAKEiC,SAxDsB,SAACI,EAAkBC,QAAAA,IAAAA,IAAAA,EAA2B,CAAE,GACtE,IAAMC,EAASC,EAAOH,GACRI,EAAGD,IAWjB,OATKC,EAASC,SAAWH,EAAOG,UAAYL,IAC1CI,EAASC,QAAUjD,EAAWU,EAAA,CAAA,EACzBb,EACAgD,IAGLC,EAAOG,QAAUL,GAGZI,EAASC,OAClB,EA4CF"}